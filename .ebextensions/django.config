packages:
  yum:
    gcc: []  
    gcc-c++: []  
    make: []  
    libpq-devel: []  # Required for PostgreSQL  
    python3-devel: []  # Required for some Python packages  
    freetype-devel: []  # Required for image processing (Pillow)  
    zlib-devel: []  # Required for compression libraries  

option_settings:
  aws:elasticbeanstalk:application:environment:
    DJANGO_SETTINGS_MODULE: "loginSignup.settings.prod"
    PYTHONPATH: "/var/app/current:$PYTHONPATH"
    
    # âœ… Superuser credentials
    DJANGO_SUPERUSER_USERNAME: "admin"
    DJANGO_SUPERUSER_EMAIL: "admin@example.com"
    DJANGO_SUPERUSER_PASSWORD: "admin123"

  aws:elasticbeanstalk:container:python:
    WSGIPath: "loginSignup.wsgi:application"

  aws:elasticbeanstalk:environment:proxy:
    ProxyServer: apache

commands:
  01_install_dependencies:
    command: "source /var/app/venv/*/bin/activate && pip install -r requirements.txt"
    ignoreErrors: false

  02_print_base_dir:
    command: "echo 'BASE_DIR is set to:' && echo $PYTHONPATH"
    ignoreErrors: true

container_commands:
  03_collectstatic:
    command: "source /var/app/venv/*/bin/activate && python3 manage.py collectstatic --noinput"
    leader_only: true

  04_migrate:
    command: "source /var/app/venv/*/bin/activate && python3 manage.py migrate"
    leader_only: true

  05_create_superuser:
    command: >
      source /var/app/venv/*/bin/activate &&
      echo "from django.contrib.auth import get_user_model;
      User = get_user_model();
      if not User.objects.filter(username='$DJANGO_SUPERUSER_USERNAME').exists():
          User.objects.create_superuser('$DJANGO_SUPERUSER_USERNAME', '$DJANGO_SUPERUSER_EMAIL', '$DJANGO_SUPERUSER_PASSWORD')" |
      python3 manage.py shell
    leader_only: true
